## 第九节课MEMO

### 量化分析，如何获取Alpha

#### alpha的实操框架

Alpha，与大盘波动无关，绝对收益

金融工程模型分类——基于交易品种

- 股票、ETF，个人投资者占主导（新韭菜有一年多的平均收割周期）
  - Alpha
  - 股票对冲
  - 期现套利
- 期货，债券，机构比例比股票高（新韭菜只有三个月的平均收割周期）
  - CTA趋势
  - Mean Reversion
  - 统计套利
  - 事件驱动
  - 日内波动
- 期权策略，机构为主
  - 市场中性，delta neutral
  - I.V.Strategy
  - 3V matrix
  - +gamma +theta



1. 股票型Alpha策略

- 逻辑
  - 投资组合：一部分是精选A股市场最好的股票，构建现货投资组合（与沪深300的敞口，超配长期跑赢市场的板块）；另一部分做空股指期货，利用股指期货低成本、高杠杆的特性，对冲系统风险。以**贝塔**对冲为主要对冲方式，可市值（最常用，等市值对冲，如沪深三百）对冲
  - 等市值对冲
  - 只要长期跑赢大盘
  - 适合投资者：高风险高收益（因为精选股可能失误），中等资金规模（几十亿）（交易量容不下高资金规模）
  - 一般不择时，靠选股
- 不同时期收益曲线特点（指数 vs alpha策略收益）
  - 牛市初期：指数驻，微涨；alpha涨幅明显（挣到升水的钱）
    - 股指期货的特点：升贴水
      - 升水IF>HS300；贴水IF<HS300
      - 股指期货在熊市长期处于贴水状态，而在牛市初期会升水
      - 升水有利，交割价是交割时两个小时平均价，若做空时升水，那么交割时挣到升水部分的钱
  - 牛市中期：指数上升；alpha甚至会有小幅回撤
    - 由IF大幅升水造成
    - 考验风控
  - 熊市初期：指数下跌；alpha有波动但整体看是持平的
    - 如果在熊市有大幅增长，增加做空IF赚钱，是伪alpha策略（违规，申报的是alpha策略）

2. 商品期货配对套利策略

绝大多数退出方式：把钱亏光

针对实物交割：做空（有现货，一般为了到期保值），但要是没有现货，可能逼仓。

量化，不涉及实物，提前一个月交割

交易规则：保证金交易，交割，涨跌停，主力合约（持仓量和交易量最大的），报价与行情数据特点【股票（3s一报价）、指数（5s一报价）、商品期货（1s）】

- 商品套利（配对）交易策略原理
  - 同一板块的相关性强
  - 利用基本面分析和量化方法寻找同一产业链或板块中商品品种间价格波动相关规律，通过做多一个品种同时，做空另一配对品种的交易，获得相对稳定的价差波动收益
  - 做多便宜，做空贵的，等差价恢复到均值附近再反向平仓
  - 一些问题：
    - 伪相关性，看背后是否有基本面逻辑支撑
- 跨期套利
  - 不同到期日的期货合约价差在一个相对稳定的区间，一旦价差出现大的波动就可以进场开仓，等待价差回归后平仓止盈
    - 光大乌龙指
    - 通常远月合约流动性差一些，近月合约是主力，有个机构有张大单（期货合现货），可能一下开1000手，一下把远期合约价格压下去了。
- 产品特性跨期
  - 橡胶，每年生产有两个季节（新胶、老胶交替有稳定价差）
    - 失去套利机会的原因
      - 本质上，不再这样生产了
      - 知道这种策略的人多了
- 综合实例
  - 即使对冲了敞口，但价差可能短期内不回归，需要跨板块+多策略分散风险。
  - 但不是万能的
    - 疫情，许多品种的相关性变强，没有做到风险分散
      - 股票、黄金一起跌。为了补仓，卖流动性好（黄金），导致黄金也跌了

3. Alpha策略一般开发流程

- 基础理论，历史数据，统计分析

- 策略建模

- 追溯测试——对回测结果调整策略

- 修正错误——可能需要反复

- 自动化操作

  

#### 获取Alpha的交易型策略的逻辑简介

- 交易型策略：根据市场交易中经常出现的某种规律性现象，可以制定的相应获利策略

1. 多空策略：价差是发散的，“强者恒强、弱者恒弱

- HANS123
  - 开盘前30min检测价格波动，上轨（最高价）、下轨（最低价）
    - 检测开盘，晚上休盘的时候消化信息，体现多空的博弈结果
  - 价差突破上轨，做多（“强者恒强”）；价差突破下轨，做空
  - 限制一天内的反向次数
  - 外汇，价格受关键节点感染，趋势维持一段时间。但现在不太好使，波动大
  - 日内交易最好不要用分钟线的收盘价，最好用最高价/最低价，可以避免信号闪烁

2. 回归策略：“天道轮回”

- 交易标的配对价差，同一标的的不同表现形式
- 逻辑假设：均值回复，做价差的收敛
- ETF套利（ETF和一篮子股票）
  - 一级市场：ETF可以赎回成股票，股票可转ETF
    - IOPY（基金份额参考净值）：指交易时间内，申购、赎回清单中组合证券（韩预估现金部分）的实时市值，主要提供交易者交易、申购、赎回基金份额时参考
  - 折价
  - 溢价（IOPY低于ETF），先买股票，再申购成ETF
  - 一二级市场套利：ETF对应一揽子股票，可以用股票申购ETF，也可以把ETF赎回成股票
    反映一级市场净值的IOPV：基金份额参考净值，组合证券的实时市值
    套利空间：IOPV和二级市场ETF的价差，可以买入ETF，换成HS300，然后在股票市场上卖出股票；反之买300支成分股，去一级市场申购ETF，再在二级市场卖ETF
  - 折溢价差是否会回归
- 二级市场轮动（一种底层资产对应的ETF之间）
  - 同一底层资产对应ETF产品有若干值，每个产品的交易价格与IOPV之间的折溢价可能有很大差别
  - 买折价多的，卖溢价多的
  - 产生的原因
    - ETF流动性
    - 资金利用率
    - 基金经理的交易习惯（调整频率）
    - 基金的考核方式
  - 但可能会踩坑，价差观察到了但没法实现
- 期现套利
  - 交易日必然回归，抄不动了
- 以上3种，什么情况下需要对冲
  - 一二级市场套利：买卖时直接实现价差，比的是操作速度，不需要对冲
  - 二级市场轮动：ETF都是多头，卖高买低，因为持有的都是多头资产，若下跌则资产缩水，需要等市值的IF做空头对冲
  - 期现套利，有做多做空，无敞口（静市值为0）



### Python数学工具

1. 凸优化
2. 逼近法
3. 积分

- 数值积分

  - 函数库：`import scipy.integrate as spi`
    - fixed_quad，固定高斯求积
    - quad，自适应求积
    - romberg，勒贝格积分
  - 定积分：给出上下限、被积函数

- 蒙特卡洛模拟积分

  估计值随随机值数量的增加而收敛

  - 在积分区间内取一个随机的x值，并计算每隔随机x值处的积分函数值
  - 加总所有函数值并取其平均值，就可以得到积分区间中的平均函数值
  - 将该值乘以积分区间长度，得以估算积分

4. Sympy库

- 化简函数 `SymPy.simplify`
- 求解方程 `SymPy.solve`
- 微分运算，全局最小值的必要不充分条件微分=0

### Python高性能计算库

选择库，选择编译方案（Python是解释性语言），考虑并行化

1. 数值计算

- 库：numexpr

  ```Python
  import numexpr as ne
  import numpy as np
  ny,ny = 1200,1500
  a = np.linspace(0.,3.141,nx*ny).reshape(nx,ny)
  for i in range(100):
  	#b = np.sin(a+i)**2 + np.cos(a+i)**2,a**1.5
  	ne.evaluate("function expression") #更快
  ```

2. 并行计算

- 库：multiprocessing

3. 编译方案

- 动态
  - 库：Numba
- 静态
  - 库：Cython



